{
    "name": "MoveIt 2 Humble Dev Container",
    "build": {
        "dockerfile": "Dockerfile"
    },
    "runArgs": [
        "--privileged",
        "--net=host",
        "--device=/dev/dri/:/dev/dri",
        "--volume=/tmp/.X11-unix:/tmp/.X11-unix:rw",
        "--runtime=nvidia",
        "--gpus=all",
        "--ipc=host" // Often helpful for ML/GPU workloads
    ],
    "mounts": [
        // Point to your specific Miniforge package cache on the host
        "source=${localEnv:HOME}/miniforge3/pkgs,target=/home/vscode/conda/pkgs,type=bind,consistency=cached"
    ],
    "containerEnv": {
        "DISPLAY": "${localEnv:DISPLAY}",
        "XAUTHORITY": "/root/.Xauthority",
        "NVIDIA_VISIBLE_DEVICES": "all",
        "NVIDIA_DRIVER_CAPABILITIES": "compute,utility"
    },
    "workspaceMount": "source=${localWorkspaceFolder},target=/ws_lucas,type=bind",
    "workspaceFolder": "/ws_lucas",
    "customizations": {
        "vscode": {
            "extensions": [
                "ms-vscode.cpptools",
                "ms-python.python",
                "mechatroner.rainbow-csv",
                "mhutchie.git-graph",
                "ms-toolsai.jupyter",
                "ms-toolsai.vscode-jupyter-cell-tags",
                "ms-toolsai.vscode-jupyter-renderers",
                "ms-toolsai.vscode-jupyter-keymap",
                "ms-toolsai.vscode-jupyter-slideshow",
                "ms-toolsai.vscode-jupyter-cell-variables",
                "ms-toolsai.vscode-jupyter-cell-outputs"
            ],
            "settings": {
                "terminal.integrated.defaultProfile.linux": "bash",
                "terminal.integrated.profiles.linux": {
                    "bash": {
                        "path": "/bin/bash",
                        "args": [
                            "--login"
                        ]
                    }
                }
            }
        }
    },
    // This command now runs as root by default.
    "postCreateCommand": ".devcontainer/post-create.sh",
    // Set 'root' as the default user for the container and VS Code terminals.
    "remoteUser": "root"
}